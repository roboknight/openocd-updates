# Set adapter speed to 20MHz
if { [info exists SET_SPEED] } {
	global _SET_SPEED
	set _SET_SPEED $SET_SPEED
} else {
	global _SET_SPEED
	set _SET_SPEED 20000
}
global _SET_SPEED
adapter_khz $_SET_SPEED

if { [info exists CHIPNAME] } {
   set  _CHIPNAME $CHIPNAME
} else {
   set  _CHIPNAME blackfin
}

if { [info exists ENDIAN] } {
   set  _ENDIAN $ENDIAN
} else {
   set  _ENDIAN big
}

if { [info exists CPUTAPID] } {
   set  _CPUTAPID $CPUTAPID
} else {
   set  _CPUTAPID 0x627a50cb
}

#configure reset
jtag_ntrst_delay 100

#jtag scan chain
reset_config trst_only trst_open_drain 

jtag newtap $_CHIPNAME cpu -irlen 5 -ircapture 0x1 -irmask 0x7 -expected-id $_CPUTAPID

set _TARGETNAME $_CHIPNAME.cpu
target create $_TARGETNAME blackfin -endian $_ENDIAN -chain-position $_TARGETNAME 

$_TARGETNAME configure -event reset-start { 
	global _SET_SPEED
	adapter_khz $_SET_SPEED 
}

$_TARGETNAME configure -event reset-end   { 
	# Stop watchdog
	echo "Halting watchdog..."
	mwh 0xffc00200 0x0ad0
}

$_TARGETNAME configure -event gdb-attach {
	reset halt
}

# For more information about the configuration files, take a look at:
# openocd.texi
